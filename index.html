<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HVAC Inventory Manager</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    
    <!-- PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HVAC Inventory">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Processing Overlay -->
<div class="processing-overlay" id="processingOverlay">
    <div class="processing-content">
        <div class="spinner"></div>
        <h2>‚è≥ Processing...</h2>
        <p>Please wait...</p>
    </div>
</div>

<!-- Login Screen -->
<div class="login-screen" id="loginScreen">
    <div class="login-box">
        <h1>üîß</h1>
        <h1>HVAC Inventory</h1>
        <p>Enter your PIN to continue</p>
        <div class="error-msg" id="errorMsg">‚ùå Invalid PIN</div>
        <input type="password" class="pin-input" id="pinInput" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" inputmode="numeric" pattern="[0-9]*" autocomplete="off" autofocus>
        <button class="btn btn-primary" id="loginBtn" style="width: 100%;">Login</button>
    </div>
</div>

<!-- Main App -->
<div class="app-container" id="appContainer">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                <div>
                    <h1>üîß HVAC Inventory</h1>
                    <p>Track parts from shop ‚Üí truck ‚Üí job</p>
                </div>
                <button class="btn btn-refresh" id="refreshBtn">üîÑ</button>
            </div>
            <div class="user-info">
                <span class="user-badge" id="userBadge">Loading...</span>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs" id="tabContainer"></div>
        
        <!-- Dashboard - LOW STOCK -->
        <div id="dashboard" class="content active">
            <h2>‚ö†Ô∏è Low Stock Alert</h2>
            <div id="lowStockContainer"></div>
        </div>
        
        <!-- All Parts -->
        <div id="all-parts" class="content">
            <div style="margin-bottom: 15px;">
                <input type="text" id="searchAllParts" placeholder="üîç Search parts..." class="search-input">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; margin-right: 10px;">Filter:</label>
                <button class="btn btn-secondary filter-btn active" data-filter="all">All Parts</button>
                <button class="btn btn-secondary filter-btn" data-filter="category">By Category</button>
            </div>
            
            <div id="categoryFilterContainer" style="display: none; margin-bottom: 15px;">
                <select id="categoryFilter" class="category-select">
                    <option value="">All Categories</option>
                </select>
            </div>
            
            <div id="allPartsGrid" class="parts-grid"></div>
        </div>
        
        <!-- Quick Actions -->
        <div id="quick-actions" class="content">
            <h2>‚ö° Quick Actions</h2>
            
            <!-- Scan Mode Toggle -->
            <div class="scan-mode-toggle" id="scanModeToggle" style="display: none;">
                <h3>üì∑ Barcode Scan Mode</h3>
                <p>Select action, then scan items</p>
                <div class="form-row">
                    <select id="scanAction" class="form-select">
                        <option value="">-- Select Action --</option>
                        <option value="use">Use on Job</option>
                        <option value="load">Load Truck</option>
                        <option value="return">Return to Shop</option>
                        <option value="receive">Receive to Shop</option>
                    </select>
                    <select id="scanTruck" class="form-select"></select>
                    <input type="text" id="scanJobName" placeholder="Job name (optional)" class="form-input">
                </div>
                <button class="btn btn-danger" id="exitScanMode">Exit Scan Mode</button>
            </div>
            
            <!-- Manual Actions -->
            <div id="manualActions">
                <div class="action-card">
                    <h3>üîß Use Parts on Job</h3>
                    <div class="form-group">
                        <label>From Truck</label>
                        <select id="useTruck"></select>
                    </div>
                    <div class="form-group">
                        <label>Select Part</label>
                        <button type="button" class="btn btn-secondary part-select-btn" data-context="use">Choose Part</button>
                        <div class="selected-part-display" id="usePartDisplay"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Quantity</label>
                            <input type="number" id="useQty" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label>Job Name</label>
                            <input type="text" id="jobName" placeholder="Optional">
                        </div>
                    </div>
                    <button class="btn btn-primary" id="usePartsBtn">Use Parts</button>
                </div>
                
                <div class="action-card">
                    <h3>üì¶ Load Truck from Shop</h3>
                    <div class="form-group">
                        <label>Select Part</label>
                        <button type="button" class="btn btn-secondary part-select-btn" data-context="load">Choose Part</button>
                        <div class="selected-part-display" id="loadPartDisplay"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Quantity</label>
                            <input type="number" id="loadQty" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label>To Truck</label>
                            <select id="loadTruck"></select>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="loadTruckBtn">Load Truck</button>
                </div>
                
                <div class="action-card">
                    <h3>‚Ü©Ô∏è Return to Shop</h3>
                    <div class="form-group">
                        <label>From Truck</label>
                        <select id="returnTruck"></select>
                    </div>
                    <div class="form-group">
                        <label>Select Part</label>
                        <button type="button" class="btn btn-secondary part-select-btn" data-context="return">Choose Part</button>
                        <div class="selected-part-display" id="returnPartDisplay"></div>
                    </div>
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" id="returnQty" value="1" min="1">
                    </div>
                    <button class="btn btn-primary" id="returnBtn">Return to Shop</button>
                </div>
                
                <div class="action-card">
                    <h3>üîÑ Transfer Between Trucks</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>From Truck</label>
                            <select id="transferFromTruck"></select>
                        </div>
                        <div class="form-group">
                            <label>To Truck</label>
                            <select id="transferToTruck"></select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Select Part</label>
                        <button type="button" class="btn btn-secondary part-select-btn" data-context="transfer">Choose Part</button>
                        <div class="selected-part-display" id="transferPartDisplay"></div>
                    </div>
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" id="transferQty" value="1" min="1">
                    </div>
                    <button class="btn btn-primary" id="transferBtn">Transfer</button>
                </div>
            </div>
        </div>
        
        <!-- Quick Load -->
        <div id="quick-load" class="content">
            <h2>üöõ Quick Load</h2>
            
            <div class="form-row" style="margin-bottom: 20px;">
                <div class="form-group">
                    <label>Location</label>
                    <select id="quickLoadLocation">
                        <option value="">-- Select --</option>
                        <option value="shop">üè™ Shop</option>
                    </select>
                </div>
            </div>
            
            <div id="quickLoadList"></div>
            <button class="btn btn-primary" id="quickLoadBtn" style="display: none; margin-top: 20px;">Load Selected Items</button>
        </div>
        
        <!-- Receive Stock -->
        <div id="receive-stock" class="content">
            <h2>üì• Receive Stock</h2>
            
            <div class="form-group">
                <label>Select Part</label>
                <button type="button" class="btn btn-secondary part-select-btn" data-context="receive">Choose Part</button>
                <div class="selected-part-display" id="receivePartDisplay"></div>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <input type="number" id="receiveQty" value="1" min="1">
            </div>
            <button class="btn btn-primary" id="receiveStockBtn">Receive Stock</button>
        </div>
        
        <!-- Add Part -->
        <div id="add-part" class="content">
            <h2>‚ûï Add New Part</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Part Number *</label>
                    <input type="text" id="partNumber" placeholder="e.g., CAP-455">
                </div>
                <div class="form-group">
                    <label>Part Name *</label>
                    <input type="text" id="partName" placeholder="e.g., Capacitor 45/5">
                </div>
                <div class="form-group">
                    <label>Category *</label>
                    <select id="partCategory"></select>
                </div>
                <div class="form-group">
                    <label>Barcode</label>
                    <input type="text" id="partBarcode" placeholder="Scan or enter">
                    <button type="button" class="btn btn-secondary barcode-scan-btn" data-target="partBarcode" style="margin-top: 5px;">üì∑ Scan Barcode</button>
                </div>
                <div class="form-group">
                    <label>Image</label>
                    <input type="file" id="partImageFile" accept="image/*" capture="environment" style="display: none;">
                    <button type="button" class="btn btn-secondary" id="uploadImageBtn">üì∑ Photo</button>
                    <div id="imagePreview" style="display: none; margin-top: 10px;">
                        <img id="imagePreviewImg" style="max-width: 100%; max-height: 150px; border-radius: 8px;">
                        <button type="button" onclick="clearImageUpload()" class="btn btn-danger" style="margin-top: 5px; padding: 5px 10px;">Remove</button>
                    </div>
                    <input type="url" id="partImageUrl" placeholder="Or paste URL" style="margin-top: 5px;">
                </div>
                <div class="form-group">
                    <label>Season</label>
                    <select id="partSeason">
                        <option value="year-round">Year-Round</option>
                        <option value="cooling">Cooling</option>
                        <option value="heating">Heating</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Shop Qty</label>
                    <input type="number" id="shopQty" value="0" min="0">
                </div>
                <div class="form-group">
                    <label>Min Shop Stock</label>
                    <input type="number" id="minStock" value="2" min="0">
                </div>
                <div class="form-group">
                    <label>Price</label>
                    <input type="number" id="partPrice" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Purchase Link</label>
                    <input type="url" id="partLink" placeholder="https://...">
                </div>
            </div>
            
            <h3 style="margin-top: 20px;">Truck Minimums</h3>
            <div id="truckMinimumsContainer" class="form-grid"></div>
            
            <button class="btn btn-primary" id="addPartBtn" style="margin-top: 20px;">Add Part</button>
        </div>
        
        <!-- Categories -->
        <div id="categories" class="content">
            <h2>üìÅ Categories</h2>
            
            <div class="form-row" style="margin-bottom: 20px;">
                <input type="text" id="newCategoryName" placeholder="Category name" style="flex: 1;">
                <select id="newCategoryParent" style="flex: 1;">
                    <option value="">Top Level</option>
                </select>
                <button class="btn btn-primary" id="addCategoryBtn">Add</button>
            </div>
            
            <div id="categoryTree"></div>
        </div>
        
        <!-- History -->
        <div id="history" class="content">
            <h2>üìã History</h2>
            <div id="historyList"></div>
        </div>
        
        <!-- Settings -->
        <div id="settings" class="content">
            <h2>‚öôÔ∏è Settings</h2>
            
            <div class="settings-section">
                <h3>Active Seasons</h3>
                <p style="color: #666; margin-bottom: 10px;">Select which seasons to track for low stock alerts</p>
                <div class="season-checkboxes">
                    <label><input type="checkbox" class="active-season-cb" value="year-round"> Year-Round</label>
                    <label><input type="checkbox" class="active-season-cb" value="heating"> Heating</label>
                    <label><input type="checkbox" class="active-season-cb" value="cooling"> Cooling</label>
                </div>
                <button class="btn btn-primary" id="saveSeasonsBtn" style="margin-top: 10px;">Save Seasons</button>
            </div>
            
            <div class="settings-section">
                <h3>My Account</h3>
                <button class="btn btn-secondary" id="changePinBtn">Change PIN</button>
            </div>
            
            <div class="settings-section">
                <h3>Trucks</h3>
                <div class="form-row">
                    <input type="text" id="newTruckName" placeholder="Truck name" style="flex: 1;">
                    <button class="btn btn-primary" id="addTruckBtn">Add Truck</button>
                </div>
                <div id="truckList" style="margin-top: 15px;"></div>
            </div>
            
            <div class="settings-section">
                <h3>Users</h3>
                <div class="form-grid">
                    <input type="text" id="newUserName" placeholder="Name">
                    <input type="tel" id="newUserPin" placeholder="PIN" maxlength="4">
                    <select id="newUserTruck"></select>
                    <button class="btn btn-primary" id="addUserBtn">Add User</button>
                </div>
                <div id="userList" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>
</div>

<!-- Part Modal -->
<div class="modal" id="partModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Select Part</h2>
            <button class="modal-close" id="closePartModal">‚úï</button>
        </div>
        <input type="text" id="partModalSearch" placeholder="üîç Search..." class="modal-search">
        <div class="modal-body" id="partModalBody"></div>
    </div>
</div>

<!-- Part Detail Modal -->
<div class="modal" id="partDetailModal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2 id="partDetailTitle">Part Details</h2>
            <button class="modal-close" id="closePartDetailModal">‚úï</button>
        </div>
        <div class="modal-body" id="partDetailBody"></div>
    </div>
</div>

<!-- Barcode Scanner Modal -->
<div class="modal" id="barcodeScannerModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Scan Barcode</h2>
            <button class="modal-close" id="closeBarcodeScannerModal">‚úï</button>
        </div>
        <div class="scanner-container">
            <video id="barcodeScannerVideo" autoplay></video>
            <div class="scanner-overlay">
                <div class="scanner-box"></div>
                <p>Point camera at barcode</p>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/@zxing/library@0.19.1/umd/index.min.js"></script>
<script src="script.js?v=10"></script>

</body>
</html>
